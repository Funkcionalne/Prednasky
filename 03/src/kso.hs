kso :: [t] -> Int -> [[t]]
kso xs k = (foldr f ([[]] : repeat []) xs) !! k
        
-- f x = scanl1 $ (++) . map (x :)
-- f x y = (scanl1 $ (++) . map (x :)) y
-- f x y = scanl1 ((++) . map (x :)) y
-- f x y = scanl1 (\acc -> \ws -> ((++) . map (x :)) acc ws) y
-- f x y = scanl1 (\acc -> \ws -> ((++)  (map (x :) acc) ws)) y

f :: t -> [[[t]]] -> [[[t]]]
f x y = scanl1 (\acc -> \ws -> ((map (x :) acc) ++ ws)) y

f' :: t -> [[[t]]] -> [[[t]]]
f' x y = scanl1 g y
                        where
                                --g        :: [[t]] -> [[t]] -> [[t]]
                                g acc ws =(map (x :) acc) ++ ws

{-
kso [1,2,3] 4 =
[[1,1,1,1],[1,1,1,2],[1,1,1,3],[1,1,2,2],[1,1,2,3],[1,1,3,3],[1,2,2,2],[1,2,2,3],[1,2,3,3],[1,3,3,3],[2,2,2,2],[2,2,2,3],[2,2,3,3],[2,3,3,3],[3,3,3,3]]

repeat [] = [ [], [], [], [], [], ...                 
[[]] : repeat [] = [ [[]], [], [], [], [], ...                 

f 4 ([[]] : repeat []) = [[[]],[[4]],[[4,4]],[[4,4,4]],[[4,4,4,4]],[[4,4,4,4,4]],[[4,4,4,4,4,4]],[[4,4,4,4,4,4,4]],[[4,4,4,4,4,4,4,4]],[[4,4,4,4,4,4,4,4,4]]]

f 3 $ f 4 ([[]] : repeat []) = [[[]],[[3],[4]],[[3,3],[3,4],[4,4]],[[3,3,3],[3,3,4],[3,4,4],[4,4,4]],[[3,3,3,3],[3,3,3,4],[3,3,4,4],[3,4,4,4],[4,4,4,4]],[[3,3,3,3,3],[3,3,3,3,4],[3,3,3,4,4],[3,3,4,4,4],[3,4,4,4,4],[4,4,4,4,4]],[[3,3,3,3,3,3],[3,3,3,3,3,4],[3,3,3,3,4,4],[3,3,3,4,4,4],[3,3,4,4,4,4],[3,4,4,4,4,4],[4,4,4,4,4,4]],[[3,3,3,3,3,3,3],[3,3,3,3,3,3,4],[3,3,3,3,3,4,4],[3,3,3,3,4,4,4],[3,3,3,4,4,4,4],[3,3,4,4,4,4,4],[3,4,4,4,4,4,4],[4,4,4,4,4,4,4]],[[3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,4],[3,3,3,3,3,3,4,4],[3,3,3,3,3,4,4,4],[3,3,3,3,4,4,4,4],[3,3,3,4,4,4,4,4],[3,3,4,4,4,4,4,4],[3,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4]],[[3,3,3,3,3,3,3,3,3],[3,3,3,3,3,3,3,3,4],[3,3,3,3,3,3,3,4,4],[3,3,3,3,3,3,4,4,4],[3,3,3,3,3,4,4,4,4],[3,3,3,3,4,4,4,4,4],[3,3,3,4,4,4,4,4,4],[3,3,4,4,4,4,4,4,4],[3,4,4,4,4,4,4,4,4],[4,4,4,4,4,4,4,4,4]]]

f 2 $ f 3 $ f 4 ([[]] : repeat []) = 
[[[]],[[2],[3],[4]],[[2,2],[2,3],[2,4],[3,3],[3,4],[4,4]],[[2,2,2],[2,2,3],[2,2,4],[2,3,3],[2,3,4],[2,4,4],[3,3,3],[3,3,4],[3,4,4],[4,4,4]],[[2,2,2,2],[2,2,2,3],[2,2,2,4],[2,2,3,3],[2,2,3,4],[2,2,4,4]

f 1 $f 2 $ f 3 $ f 4 ([[]] : repeat []) = [[[]],[[1],[2],[3],[4]],[[1,1],[1,2],[1,3],[1,4],[2,2],[2,3],[2,4],[3,3],[3,4],[4,4]],[[1,1,1],[1,1,2],[1,1,3],[1,1,4],[1,2,2],[1,2,3],[1,2,4],[1,3,3],[1,3,4],[1,4,4],[2,2,2],[2,2,3],[2,2,4],[2,3,3],[2,3,4],[2,4,4],[3,3,3],[3,3,4],[3,4,4],[4,4,4]],[[1,1,1,1],[1,1,1,2],[1,1,1,3],[1,1,1,4],[1,1,2,2],[1,1,2,3],[1,1,2,4],[1,1,3,3],[1,1,3,4],[1,1,4,4],[1,2,2,2],[1,2,2,3],[1,2,2,4],[1,2,3,3],[1,2,3,4],[1,2,4,4],[1,3,3,3],[1,3,3,4],[1,3,4,4],[1,4,4,4],[2,2,2,2],[2,2,2,3],[2,2,2,4],[2,2,3,3],[2,2,3,4],[2,2,4,4],[2,3,3,3],[2,3,3,4],[2,3,4,4],[2,4,4,4],[3,3,3,3],[3,3,3,4],[3,3,4,4],[3,4,4,4],[4,4,4,4]]]

-}